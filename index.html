<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Supabase Viewer</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <style>
    body { font-family: sans-serif; padding: 1rem; }
    input[type="text"] {
      padding: 0.5rem;
      margin-bottom: 1rem;
      width: 100%;
      max-width: 400px;
      font-size: 1rem;
    }
    table { border-collapse: collapse; width: 100%; margin-top: 1rem; }
    th, td { border: 1px solid #ccc; padding: 0.5rem; text-align: left; }
  </style>
</head>
<body>
  <h1>Game List</h1>
  <input type="text" id="searchInput" placeholder="Search by title or platform..." />

  <table id="data-table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Title</th>
        <th>Platform</th>
        <th>Release Date</th>
        <th>Playtime</th>
        <th>RAWG Rating</th>
        <th>Genre</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const SUPABASE_URL = 'https://mbdrtvxcjijgzxlzlfzw.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1iZHJ0dnhjamlqZ3p4bHpsZnp3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUxNjQ2NzYsImV4cCI6MjA2MDc0MDY3Nn0.8phlukCcNjY0QQ5LDsl4KFnawuUoXwHCR2OuxLrLZVQ';

    const client = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    let fullData = [];

    async function loadGames() {
      const { data, error } = await client
        .from('games')
        .select('id, title, platform, release_date, playtime, rawg_rating, genre');

      if (error) {
        console.error('Error fetching data:', error);
        return;
      }

      fullData = data;
      displayData(data);
    }

    function displayData(data) {
      const tbody = document.querySelector('#data-table tbody');
      tbody.innerHTML = '';
      data.forEach(row => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${row.id}</td>
          <td>${row.title}</td>
          <td>${row.platform}</td>
          <td>${row.release_date ?? ''}</td>
          <td>${row.playtime ?? ''}</td>
          <td>${row.rawg_rating ?? ''}</td>
          <td>${row.genre ?? ''}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    document.getElementById('searchInput').addEventListener('input', function(e) {
      const search = e.target.value.toLowerCase();
      const filtered = fullData.filter(row =>
        row.title?.toLowerCase().includes(search) || row.platform?.toLowerCase().includes(search)
      );
      displayData(filtered);
    });

    loadGames();
    setInterval(loadGames, 5000);
  </script>
</body>
</html>
